{% extends 'dashboard/base.html' %} {% load static %} {% block stylesheets %}
<link rel="stylesheet" type="text/css" href="{% static 'dashboard/datatables/datatables.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'dashboard/css/addon_datatables.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'dashboard/css/style.css' %}" />
{% endblock stylesheets %} {% block title %} {{ title }} {% endblock title %}
{%block body_content %}

<div class="card-panel deep-orange accent-3">
  <div class="card-container center-align">
    <h4 class="deep-orange-text accent-3 white-text">
      Vous pouvez toujours ajouter un nouveau produit.
    </h4>
    <p class="white-text lighten-4">
      remplissez seuls les informations que vous avez sur le produit
    </p>
  </div>
</div>

<div class="card-panel" id="productID">
  <form action="" method="post">
    {% csrf_token %}
    <input type="hidden" name="next" value="{{ request.path }}" />
    <div class="row">
      {% if user.is_superuser %}
      <div class="input-field col s12">
        {{ form.shop}}
        <label for="{{form.shop.id_for_label}}">Choisir la Boutique</label>
      </div>
      {% endif %}

      <div class="input-field col m5 s12">
        {{ form.seller }}
        <label for="{{form.seller.id_for_label}}">Client</label>
      </div>
      <div class="input-field col m1 s6">
        <a href="{% url 'clients:clientPage' %}" name="clientID" class="btn-flat deep-orange-text accent-3 tooltipped"
          data-position="bottom" data-tooltip="Nouveau Client">
          <i class="material-icons right">person_add</i>
        </a>
      </div>

      <div class="input-field col m3 s6">
        {{ form.category }}
        <label for="{{form.category.id_for_label}}">Catégory</label>
      </div>
      <div class="input-field col m3 s6">
        {{ form.name }}
        <label for="{{form.name.id_for_label}}">Nom Produit</label>
      </div>
      <div class="input-field col m3 s6">
        {{ form.quantity }}
        <label for="{{form.quantity.id_for_label}}">Quantité</label>
      </div>

      <div class="input-field col m3 s6">
        {{ form.dv_or_ad }}
        <label for="{{form.dv_or_ad.id_for_label}}">Depot Vente ou Achat</label>
      </div>
      <div class="input-field col m3 s6">
        {{ form.price }}
        <label for="{{form.price.id_for_label}}">Prix Unitaire</label>
      </div>
      <div class="input-field col m3 s6">
        {{ form.montant_restauration }}
        <label for="{{form.montant_restauration.id_for_label}}">Montant Restauration
        </label>
      </div>
      <div class="input-field col m3 s6">
        {{ form.dimension }}
        <label for="{{form.dimension.id_for_label}}">Dimension</label>
      </div>
      <div class="input-field col m3 s6">
        {{ form.estate }}
        <label for="{{form.estate.id_for_label}}">Etat</label>
      </div>
      <div class="input-field col m3 s6">
        {{ form.obsolescence }}
        <label for="{{form.obsolescence.id_for_label}}">Obsolescence</label>
      </div>
      <div class="input-field col m3 s6">
        {{ form.rarety }}
        <label for="{{form.rarety.id_for_label}}">Rarete</label>
      </div>

      <div class="input-field col m3 s6">
        {{ form.storage }}
        <label for="{{form.storage.id_for_label}}">Memoire de Stockage</label>
      </div>
      <div class="input-field col m3 s6">
        {{ form.ram }}
        <label for="{{form.ram.id_for_label}}">Memoire RAM</label>
      </div>
      <div class="input-field col m3 s6">
        {{ form.model }}
        <label for="{{form.model.id_for_label}}">Model du produit</label>
      </div>
      <div class="input-field col m3 s6">
        {{form.edition}}
        <label for="{{form.edition.id_for_label}}">Edition</label>
      </div>
      <div class="input-field col m3 s6">
        {{ form.annee }}
        <label for="{{form.annee.id_for_label}}">Annee </label>
      </div>
      <div class="input-field col m3 s6">
        {{ form.color }}
        <label for="{{form.color.id_for_label}}">Couleur</label>
      </div>

      <div class="col s12">
        <label for="{{form.description.id_for_label}}">
          {{ form.description }}
          <span>Description du produit</span>
        </label>
      </div>
      <br />
      <div class="row">
        <div class="input-field col m3 s6">
          <label for="{{form.charger.id_for_label}}">
            {{ form.charger }}
            <span>Chargeur</span>
          </label>
        </div>
        <div class="input-field col m3 s6">
          <label for="{{form.original_box.id_for_label}}">
            {{ form.original_box }}
            <span>Boite d'origine</span>
          </label>
        </div>
        <div class="input-field col m3 s6">
          <label for="{{form.sale_bill.id_for_label}}">
            {{ form.sale_bill }}
            <span>Facture d'Achat</span>
          </label>
        </div>
        <div class="input-field col m3 s6">
          <label for="{{form.connectic.id_for_label}}">
            {{ form.connectic }}
            <span>Connectiques</span>
          </label>
        </div>
      </div>
      <div class="row">
        <div class="input-field col m3 s6">
          <button class="waves-effect waves-green black btn-flat" type="submit">
            <i class="material-icons right deep-orange-text accent-3 right">thumb_up_alt</i>
            <b class="deep-orange-text accent-3">Enregistrer</b>
          </button>
        </div>
      </div>
    </div>
  </form>
</div>

<div class="row">
  <div id="man" class="col s12">
    <div class="card material-table">
      <div class="table-header">
        <span class="table-title">Liste des produits</span>
        <div class="actions">
          <a href="#man" class="search-toggle waves-effect btn-flat nopadding"><i class="material-icons">search</i></a>
        </div>
        <div class="row center-align with-pd" style="margin-left: 10px; margin-right: 2px;">
          <button id='delete' type='submit' class="red darken-1 btn white-text">
            <i class="material-icons left"></i>Supprimer
          </button>
        </div>
      </div>
      <table id="datatable" class="responsive-table">
        <thead>
          <tr>
            <th>article</th>
            <th>date</th>
            <th>nom</th>
            <th>prix unitaire</th>
            <th>quantité</th>
            <th>actions</th>
            <th style="text-align:center;">supprimer</th>
          </tr>
        </thead>
        <tbody>
          {% for product in products %}
          <tr id="product.id">
            <th class="black-text">{{ product.id }}</th>
            <th class="black-text">{{ product.created_date|date:"SHORT_DATE_FORMAT" }}</th>
            <th class="black-text">{{ product.name|truncatechars:15 }}</th>
            <th class="black-text">{{ product.price|floatformat:0 }} fcfa</th>
            <th class="black-text">{{ product.quantity }} / {{product.initial_quantity}}</th>
            <th class="actions black-text">
              <a href="{% url 'dashboard:productDetailPage' product.pk %}"
                class="orange-text darken-4 waves-effect btn-flat tooltipped" data-position="left"
                data-tooltip="Voir"><span class="material-icons">visibility</span></a>
              <a href="{% url 'dashboard:productEditPage' product.pk %}"
                class="green-text darken-4 waves-effect btn-flat tooltipped" data-position="left"
                data-tooltip="Modifier"><span class="material-icons">update</span></a>
              <!-- <a href="{% url 'dashboard:productDeletePage' product.pk %}"
                class="red-text accent-4 waves-effect btn-flat tooltipped" data-position="left"
                data-tooltip="Supprimer"><span class="material-icons">delete</span></a> -->
            </th>
            <th>
              <label class="">
                <input type="checkbox" name='product_id[]' value='{{product.id}}' id='delete_product' />
                <span></span>
              </label>
            </th>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% endblock body_content %}
{% block javascripts %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
  //var dataset_client = JSON.parse('{{dataset_client}}')
  $(document).ready(function () {
    $('#delete').click(function () {
      if (confirm('Êtes vous sures de vouloir supprimer les éléments selectionnés?'))
        var id = [];
      $(':checkbox:checked').each(function (i) {
        id[i] = $(this).val()
        var csrf = $('input[name="csrfmiddlewaretoken"]').val();
      })
      if (id.length === 0) {
        alert("Selectionner au moins un element d'abord. SVP!")
      } else {
        console.log(id)
        $.ajax({
          url: "{% url 'dashboard:multipleDeleteProductPage' %}",
          method: 'POST',
          data: {
            id,
            csrfmiddlewaretoken: $('[name="csrfmiddlewaretoken"]').val()
          },
          success: function (response) {
            window.location.reload();
          }
        })
      }
    })
  })
</script>
<script type="text/javascript" src="{% static 'dashboard/datatables/datatables.js' %}"></script>

<script type="text/javascript" src="{% static 'dashboard/js/main.js' %}">
</script>
<script type="text/javascript" src="{% static 'dashboard/js/materialize_setup.js' %}">
</script>
<script type="text/javascript" src="{% static 'dashboard/js/materializeSelect.js' %}"></script>
{% endblock javascripts %}