{% extends 'dashboard/base.html' %}
{% load static %}
{% load humanize %}

{% block stylesheets %}
<link rel="stylesheet" type="text/css" href="{% static 'dashboard/css/style.css' %}">
{% endblock stylesheets %}

{% block body_content %}

<div class="row with-gap">

    <!--- Boutique Card -->
    <div class="col s12 m6 l3">
        <div class="card resize black">
            <div class="card-content deep-orange-text accent-3">
                <span class="card-title"> Nombre de Boutiques</span>
                <p class="p-adjust add_size ">
                    <i class="material-icons small right deep-orange-text accent-3"> store </i>
                    <span class="p-large i-adjust deep-orange-text accent-3">012</span>
                </p>
            </div>
        </div>
    </div>


    <!--- Produit Card -->
    <div class="col  s12 m6 l3">
        <div class="card resize black">
            <div class="card-content deep-orange-text accent-3">
                <span class="card-title">Nombre de Produits</span>
                <p class="p-adjust add_size ">
                    <i class="material-icons small right deep-orange-text accent-3">shopping_cart</i>
                    <span class="p-large i-adjust deep-orange-text accent-3 ">{{ n_product }}</span>
                </p>
            </div>
        </div>
    </div>

    <!--- Client Card -->
    <div class="col s12 m6 l3">
        <div class="card resize black">
            <div class="card-content deep-orange-text accent-3">
                <span class="card-title">Nombre de Clients</span>
                <p class="p-adjust add_size">
                    <i class="material-icons small right deep-orange-text accent-3">groups</i>
                    <span
                        class="p-large i-adjust deep-orange-text accent-3">{{ n_client|floatformat:0|intcomma }}</span>
                </p>
            </div>
        </div>
    </div>

    <!--- Revenue Card -->
    <div class="col s12 m6 l3">
        <div class="card resize deep-orange accent-3">
            <div class="card-content black-text">
                <span class="card-title">Benefice</span>
                <p>Mois: <b>{{benefice_month|floatformat}} </b> </p> <br>
                <p>Jours:<b> {{benefice_day|floatformat}} </b> </p>
            </div>
        </div>
    </div>
</div>

<!---- Adding Chart Achat -->
<div class="row">
    <div class="col m8 s12">
        <div class="card-panel">
            <canvas id="myChart" class="chart_bar"></canvas>
        </div>
    </div>


    <div class="section-info-easy col m4 s12">
        <!------ Product Trend Section -->
        <ul class="deposit collection with-header">
            <li class="collection-header">
                Tendance Produits
            </li>
            {% for tv in tendance_vente %}
            {% if tv.freq >= 1 %}
            <li class="collection-item avatar">
                <i class="material-icons circle green accent-3 z-depth-2">trending_up</i>
                <span class="title"><i>Vente</i></span>
                <p>{{ tv.produit.name }}<br>
                    Frequence de Vente: {{ tv.freq }}
                </p>
            </li>
            {% endif %}
            {% endfor %}
            {% for ts in tendance_achat_direct %}
            {% if ts.freq <= 1 %}
            <li class="collection-item avatar">
                <i class="material-icons circle red accent-3 z-depth-2">trending_down</i>
                <span class="title"><i>Achat Direct</i></span>
                <p>{{ ts.produit.name }}<br>
                    Produit en manque: {{ ts.freq }}
                </p>
            </li>
            {% endif %}
            {% endfor %}
        </ul>

    </div>

</div>

<!----- Tables: Achat et Depot -->
<div class="middle-section-easy row lefty">
    <!------ Section Wrapper of Tables: [8]-> 12 [now] columns-->
    <div class=" section-table-easy col s12">
        <!----- Table -->
        <div class="row-table-inner">
            <div class=" col  s12">
                <div class="card-panel grey lighten-1">
                    <div class="colright card-panel-header__wrapper">
                        <div class="black-text big-text"><b>Achat Direct</b></div>
                        <div class="bbtn">
                            <a href="{% url 'dashboard:ventePage' %}" class=" waves-effect waves-light btn-small
                                deep-orange accent-3">
                                <i class="material-icons left">visibility</i>
                                Voir Tout
                            </a>
                        </div>
                    </div>
                    <div class="divider"></div>
                    <table class="responsive-table highlight">
                        <thead class="">
                            <tr>
                                <th>Produit</th>
                                <th>Date de Vente</th>
                                <th>Prix de Vente</th>
                                <th>Garantie</th>
                                <th>Delai de Garantie</th>
                            </tr>
                        </thead>

                        <tbody>
                            <!----- Row: 1-->
                            {% for achat in achat_directs %}
                            <tr>
                                <td>{{ achat.produit.name }}</td>
                                <td>{{ achat.created_date|date:"SHORT_DATE_FORMAT" }}</td>
                                <td>{{ achat.price|floatformat:0|intcomma }}</td>
                                <td>{{ achat.guarantee|yesno:"OUI, NON" }}</td>
                                <td>{% if achat.guarantee %}{{ achat.guarantee_period }} {% else %} ------- {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                            <!----- Row: 2-->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="row-table-inner">
            <!----- Table -->
            <div class="col s12">
                <div class="card-panel grey lighten-1">
                    <div class="colright card-panel-header__wrapper">
                        <div class="black-text big-text"><b>Achat Direct</b></div>
                        <div class="bbtn">

                            <a href="{% url 'dashboard:achatDirectPage' %}"
                                class="waves-effect waves-light btn-small deep-orange accent-3">
                                <i class=" material-icons left">visibility</i>
                                Voir Tout
                            </a>
                        </div>
                    </div>
                    <div class="divider"></div>

                    <table class="responsive-table highlight">
                        <thead>
                            <tr>
                                <th>Produit</th>
                                <th>Vendeur</th>
                                <th>Date Achat</th>
                                <th>Prix Achat</th>
                                <th>Qualite</th>
                            </tr>
                        </thead>

                        <tbody>
                            <!----- Row: 1-->
                            {% for vente in ventes %}
                            <tr>
                                <td>{{ vente.produit.name }}</td>
                                <td>{{ vente.produit.seller }}</td>
                                <td>{{ vente.created_date|date:"SHORT_DATE_FORMAT" }}</td>
                                <td>{{ vente.price|floatformat:0|intcomma }}</td>
                                {% if vente.produit.estate == "NEUF" %}
                                <td><span class="new badge green"
                                        data-badge-caption="{{ vente.produit.estate }}"></span></td>
                                {% elif vente.produit.estate == "BON" %}
                                <td><span class="new badge light-green"
                                        data-badge-caption="{{ vente.produit.estate }}"></span></td>
                                {% elif vente.produit.estate == "MOYEN" %}
                                <td><span class="new badge yellow"
                                        data-badge-caption="{{ vente.produit.estate }}"></span></td>
                                {% elif vente.produit.estate == "MAUVAIS" %}
                                <td><span class="new badge light-red"
                                        data-badge-caption="{{ vente.produit.estate }}"></span></td>
                                {% else %}
                                <td><span class="new badge red" data-badge-caption="{{ vente.produit.estate }}"></span>
                                </td>
                                {% endif %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>

</div>

{% endblock body_content %}

{% block javascripts %}
<script>
    var dataset_achat = JSON.parse('{{ dataset_achat }}');
    var dataset_stock = JSON.parse('{{ dataset_stock }}');
</script>
<script src="{% static 'dashboard/js/chart_easy.js' %}"></script>
{% endblock javascripts %}