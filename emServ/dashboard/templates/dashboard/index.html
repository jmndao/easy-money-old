{% extends 'dashboard/base.html' %}
{% load static %}
{% load humanize %}

{% block stylesheets %}
    <link rel="stylesheet" type="text/css" href="{% static 'dashboard/css/style.css' %}">
{% endblock stylesheets %}

{% block body_content %}

<div class="row with-gap">

    <!--- Boutique Card -->
    <div class="col s12 m6 l3">
        <div class="card deep-orange accent-3">
            <div class="card-content white-text">
                <span class="card-title">Boutiques</span>
                <p class="p-adjust add_size">
                    <i class="material-icons small right"> store </i>
                    <span class="p-large i-adjust">012</span>
                </p>
            </div>
        </div>
    </div>

    <!--- Produit Card -->
    <div class="col s12 m6 l3">
        <div class="card deep-orange accent-3">
            <div class="card-content white-text">
                <span class="card-title">Produit</span>
                <p class="p-adjust add_size">
                    <i class="material-icons small right">shopping_cart</i>
                    <span class="p-large i-adjust ">{{ n_product }}</span>
                </p>
            </div>
        </div>
    </div>

    <!--- Client Card -->
    <div class="col s12 m6 l3">
        <div class="card deep-orange accent-3">
            <div class="card-content white-text">
                <span class="card-title">Clients</span>
                <p class="p-adjust add_size">
                    <i class="material-icons small right">groups</i>
                    <span class="p-large i-adjust">{{ n_client|floatformat:0|intcomma }}</span>
                </p>
            </div>
        </div>
    </div>

    <!--- Revenue Card -->
    <div class="col s12 m6 l3">
        <div class="card">
            <div class="card-content deep-orange-text accent-3">
                <span class="card-title">Revenue</span>
                <p class="p-adjust add_size ">
                    <i class="material-icons small right deep-orange-text accent-3">sell</i>
                    <span class="p-large i-adjust deep-orange-text accent-3">3M</span>
                </p>
            </div>
        </div>
    </div>
</div>

<!---- Adding Chart Achat -->
<div class="row">
    <div class="col m8 s12">
        <div class="card-panel">
            <canvas id="myChart" class="chart_bar"></canvas>
        </div>
    </div>


    <div class="section-info-easy col m4 s12">
        <!------ Product Trend Section -->
        <ul class="deposit collection with-header">
            <li class="collection-header">
                Tendance Produit
            </li>
            {% for ta in trend_achat %}
                {% if ta.freq >= 1 %}
                    <li class="collection-item avatar">
                        <i class="material-icons circle green accent-3 z-depth-2">trending_up</i>
                        <span class="title"><i>Achat</i></span>
                        <p>{{ ta.produit__nom_du_produit }}<br>
                            Compteur: {{ ta.freq }}
                        </p>
                    </li>
                {% endif %}
            {% endfor %}
            {% for ts in trend_stock %}
                {% if ts.freq <= 1 %}
                    <li class="collection-item avatar">
                        <i class="material-icons circle red accent-3 z-depth-2">trending_down</i>
                        <span class="title"><i>Stock</i></span>
                        <p>{{ ts.produit__nom_du_produit }}<br>
                            Compteur: {{ ts.freq }}
                        </p>
                    </li>
                {% endif %}
            {% endfor %}
        </ul>

    </div>

</div>

<!----- Tables: Achat et Depot -->
<div class="middle-section-easy row lefty">
    <!------ Section Wrapper of Tables: [8]-> 12 [now] columns-->
    <div class=" section-table-easy col s12">
        <!----- Table -->
        <div class="row-table-inner">
            <div class=" col  s12">
                <div class="card-panel grey lighten-1">
                    <div class="colright card-panel-header__wrapper">
                        <div class="black-text big-text"><b>Achat Direct</b></div>
                        <div class="bbtn">
                            <a href="{% url 'dashboard:buyingStockPage' %}" class=" waves-effect waves-light btn-small
                                deep-orange accent-3">
                                <i class="material-icons left">visibility</i>
                                Voir Tout
                            </a>
                        </div>
                    </div>
                    <div class="divider"></div>
                    <table class="responsive-table highlight">
                        <thead class="">
                            <tr>
                                <th>Produit</th>
                                <th>Date de Vente</th>
                                <th>Prix de Vente</th>
                                <th>Garantie</th>
                                <th>Delai de Garantie</th>
                            </tr>
                        </thead>

                        <tbody>
                            <!----- Row: 1-->
                            {% for achat in achats %}
                                <tr>
                                    <td>{{ achat.produit.nom_du_produit }}</td>
                                    <td>{{ achat.date_de_vente|date:"SHORT_DATE_FORMAT" }}</td>
                                    <td>{{ achat.prix_de_vente_fin|floatformat:0|intcomma }}</td>
                                    <td>{{ achat.garantie|yesno:"OUI, NON" }}</td>
                                    <td>{% if achat.garantie %}{{ achat.delai_garantie }} {% else %} ------- {% endif %}</td>
                                </tr>
                            {% endfor %}
                            <!----- Row: 2-->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="row-table-inner">
            <!----- Table -->
            <div class="col s12">
                <div class="card-panel grey lighten-1">
                    <div class="colright card-panel-header__wrapper">
                        <div class="black-text big-text"><b>Stock</b></div>
                        <div class="bbtn">

                            <a href="{% url 'dashboard:depositStockPage' %}"
                                class="waves-effect waves-light btn-small deep-orange accent-3">
                                <i class=" material-icons left">visibility</i>
                                Voir Tout
                            </a>
                        </div>
                    </div>
                    <div class="divider"></div>

                    <table class="responsive-table highlight">
                        <thead>
                            <tr>
                                <th>Produit</th>
                                <th>Vendeur</th>
                                <th>Date Achat</th>
                                <th>Prix Achat</th>
                                <th>Qualite</th>
                            </tr>
                        </thead>

                        <tbody>
                            <!----- Row: 1-->
                            {% for stock in stocks %}
                                <tr>
                                    <td>{{ stock.produit.nom_du_produit }}</td>
                                    <td>{{ stock.nom_vendeur }}</td>
                                    <td>{{ stock.date_d_achat|date:"SHORT_DATE_FORMAT" }}</td>
                                    <td>{{ stock.prix_d_achat|floatformat:0|intcomma }}</td>
                                    {% if stock.qualite == "EXCELLENT" %}
                                        <td><span class="new badge green" data-badge-caption="{{ stock.qualite}}"></span></td>
                                    {% elif stock.qualite == "NORMAL" %}
                                        <td><span class="new badge yellow" data-badge-caption="{{ stock.qualite}}"></span></td>
                                    {% else %}
                                        <td><span class="new badge red" data-badge-caption="{{ stock.qualite}}"></span></td>
                                    {% endif %}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>

</div>

{% endblock body_content %}

{% block javascripts %}
    <script>
        var dataset_achat = JSON.parse('{{ dataset_achat }}');
        var dataset_stock = JSON.parse('{{ dataset_stock }}');
    </script>
    <script src="{% static 'dashboard/js/chart_easy.js' %}"></script>
{% endblock javascripts %}